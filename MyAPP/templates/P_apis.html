<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body>


{#背景层#}
<div id="mengceng"
     style="opacity:0.5;display: none;position:absolute;left: 0;top: 100px;background-color: gray;width: 100%"></div>
{#window.screen.availHeight 返回当前屏幕高度(空白空间)#}
<script>
    document.getElementById('mengceng').style.height = window.screen.availHeight.toString() + 'px';
</script>


{#导航栏#}
<nav class="navbar navbar-default" role="navigation"
     style="position: absolute;top: 0px;left: 80px;width:-webkit-calc(100% - 200px);z-index: 1">
    <div class="container-fluid">
        <div class="navbar-header">
            <span style="font-size: xx-small" class="navbar-brand">项目名称：{{ project.name }}</span>
            <a class="navbar-brand" href="/project_list/">返回项目列表</a>
        </div>

        <div>
            <ul class="nav navbar-nav">

                <li><a href="/apis/{{ project.id }}/">接口库</a></li>
                <li><a href="/cases/{{ project.id }}/">用例库</a></li>
                <li class="active"><a href="/project_set/{{ project.id }}/">项目设置</a></li>
            </ul>
        </div>
    </div>
</nav>

{#内容部分#}
<br><br>
<table class="table table-striped">
    <thead>
    <tr>
        <th style="width: 13%">id</th>
        <th style="width: 25%">接口名称</th>
        <th style="width: 25%">请求地址</th>
        <th style="width: 20%">请求方法</th>
        <th style="width: 300px">操作</th>
    </tr>
    </thead>
    <tbody>
    {% for i in apis %}
        <tr>
            <td>{{ i.id }}</td>
            <td>{{ i.name }}</td>
            {#            <td>{{ i.api_url }}</td>#}
            <td>{{ i.short_url }}</td>
            <td>{{ i.api_method }}</td>
            <td>
                <div class="btn-group" style="z-index: 0">
                    <button class="btn btn-success" onclick="ts_show('{{ i.id }}','{{ i.name }}')">调试</button>
                    <button class="btn btn-default" onclick="open_bz('{{ i.id }}')">备注</button>
                    <button onclick="copy_api('{{ i.id }}')" class="btn btn-default">复制</button>
                    <button onclick="error_test('{{ i.id }}')" class="btn btn-default">异常值测试</button>
                    <button class="btn btn-danger" onclick="document.location.href='/project_api_del/{{ i.id }}'"
                            class="btn btn-danger">删除
                    </button>
                </div>
            </td>
            <input type="text" id="api_error_{{ i.id }}" value="{{ i.api_body }}" style="display: none">
        </tr>
    {% endfor %}
    </tbody>
</table>

{#复制接口scrip#}
<script>
    function copy_api(api_id) {
        $.get("/copy_api/", {
            'api_id': api_id
        }, function (res) {
            document.location.reload();
        })
    }

</script>


{#工具栏#}
<div style="position: fixed;bottom: 0px;width: 100%;background: #f8f8f8;text-align: center;border: 1px solid #e7e7e7">

    <div class="btn btn-group">
        <button type="button" class="btn btn-primary"
                onclick="document.location.href='/project_add_api/{{ project.id }}'">新增接口
        </button>
        <button onclick="project_header_div_show()" type="button" class="btn btn-default">全局请求头</button>
        <button onclick="project_host_div_show()" type="button" class="btn btn-default">全局域名</button>
        <button type="button" class="btn btn-default">接口文档导入</button>
        <button type="button" class="btn btn-default">抓包导入</button>
        <button type="button" class="btn btn-default">加密算法</button>
        <button onclick="login_show()" type="button" class="btn btn-default">登录态接口</button>
    </div>

</div>


{#备注 及函数#}
<div id="bz" style="display: none;width: 50%;height: 30%;position: fixed;
    left: 25%;top: 35%;background: #3c4043;box-shadow: 4px 4px 4px gray">
    <input type="text" style="display: none" id="which_api">
    <textarea name="" id="bz_value" cols="30" rows="10" style="width: 100%;height:85%" placeholder="请输入备注"></textarea>
    <button onclick="save_bz()" class="btn btn-success" style="width: 49.5%">保存</button>
    <button onclick="close_bz()" class="btn btn-danger" style="width: 49.5%">取消</button>
</div>
<script>
    function open_bz(id) {
        document.getElementById("bz_value").value = "";   //清空上一个打开的接口的内容

        $.get("/get_bz/", {
            "api_id": id
        }, function (res) {
            document.getElementById("bz").style.display = "block";
            document.getElementById("which_api").value = id;
            document.getElementById("bz_value").value = res;
        })
    };

    function save_bz(id) {

        id = document.getElementById("which_api").value;
        bz_value = document.getElementById("bz_value").value;
        $.get("/save_bz/", {
            "api_id": id,
            "bz_value": bz_value
        }, function (res) {
            alert("保存成功");
            document.getElementById("bz").style.display = "none";

        })
    };

    function close_bz(id) {
        document.getElementById("bz").style.display = "none";

    }
</script>


{# 调试窗口#}
<div id="ts"
     style="display:none;border-radius:5px;width: 50%;position: absolute;left: 20%;top: 20%;background: #3c4043;color: white;padding-left: 10px">
    <div class="btn btn-group" style="float: right;padding: 0px">
        <button onclick="ts_save()" class="btn btn-success">保存</button>
        <button onclick="ts_close()" class="btn btn-default">取消</button>
    </div>

    <h4>接口：
        <small style="color: greenyellow" id="ts_api_id"></small>
        --
        <input placeholder="请输入接口名称" style="padding-left: 5px;width: 50%;color: #329104" id="ts_api_name"></input>
    </h4>

    <ul class="nav navbar-nav" style="width: 99%">
        <li>
            <select id="ts_method" style="height: 40px;" class="form-control">
                <option value="none">请求方式</option>
                <option value="post">POST</option>
                <option value="get">GET</option>
                <option value="put">PUT</option>
                <option value="delete">DELETE</option>
            </select>
        </li>

        {#        url 输入框#}
        <li style="width: -webkit-calc(100% - 225px)">
            <input id="ts_url" style="color: #000000;padding-left: 10px;width: 100%;height: 40px;" type="text"
                   placeholder='url: 如 /abcd/efgh/' value="">
        </li>

        {#        发送按钮#}
        <li>
            <button onclick="ts_send()" type="button"
                    style="height: 40px;width: 120px;"
                    class="btn btn-default"><span style="font-size: large">Send</span></button>
        </li>
    </ul>
    <br><br><br>

    {#    请求host#}
    <ul class="nav navbar-nav" style="width: 99%">
        <li style="width: -webkit-calc(100% - 60px)">

            <datalist id="datalist_1">
                {% for i in project_host %}
                    <option id="project_host_{{ i.id }}" value="全局域名-{{ i.id }}">{{ i.name }}：{{ i.host }}</option>
                {% endfor %}

                {% for i in hosts %}
                    <option id="host_{{ i.id }}" value="{{ i.host }}">{{ i.host }}</option>
                {% endfor %}
            </datalist>

            <input list="datalist_1" id="ts_host" type="text" autocomplete="off"
                   style="color: #000000;padding-left: 10px;width: 100%;height: 40px"
                   placeholder="host:如http(s)://xxxx.com" value="">

        </li>

        {#        清除host按钮#}
        <li>
            <button onclick="ts_clear_host()" style="width: 60px;height: 40px" class="btn btn-default">重置</button>
        </li>
    </ul>

    <br><br><br>
    {#    请求头#}
    <ul class="nav navbar-nav" style="width: 99%">
        <li style="width:  -webkit-calc(100% - 127px)">
            <input id="ts_header" style="color: black;padding-left: 10px;width: 100%;height: 40px;" type="text"
                   placeholder='header请求头：如{"Content":"application/json"}' value="">
        </li>
        <li>
            <button type="button" onclick="ts_clear_header()"
                    style="height: 40px;width: 60px;"
                    class="btn btn-default"><span>Clear</span></button>
            <button type="button" onclick="ts_show_project_header()"
                    style="height: 40px;width: 60px;"
                    class="btn btn-default"><span>▼️</span></button>
        </li>
        <br>

        <li id="ts_project_header_li" style="display: none">
            {#            <label style="margin-right: 5px"><input type="checkbox">name1</label>#}
            {#             <label style="margin-right: 5px"><input type="checkbox">name2</label>#}
            {#             <label style="margin-right: 5px"><input type="checkbox">name3</label>#}
            {% for i in project_header %}
                <label style="margin-right: 5px"><input id="checkbox_{{ i.id }}" value="{{ i.id }}"
                                                        type="checkbox">{{ i.name }}</label>
            {% endfor %}


        </li>
    </ul>

    <br><br><br>

    <ul id="myTab" class="nav nav-tabs">
        <li class="active"><a id="click_none" href="#none" data-toggle="tab">none</a></li>
        <li><a href="#form-data" data-toggle="tab">form-data</a></li>
        <li><a href="#x-www-form-urlencoded" data-toggle="tab">x-www-form-urlencoded</a></li>
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">raw<b class="caret"></b></a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="myTabDrop1">
                <li><a href="#Text" tabindex="-1" data-toggle="tab">Text</a></li>
                <li><a href="#JavaScript" tabindex="-1" data-toggle="tab">JavaScript</a></li>
                <li><a href="#Json" tabindex="-1" data-toggle="tab">Json</a></li>
                <li><a href="#Html" tabindex="-1" data-toggle="tab">Html</a></li>
                <li><a href="#Xml" tabindex="-1" data-toggle="tab">Xml</a></li>
            </ul>
        </li>
        <li><a href="#GraphQL" data-toggle="tab">GraphQL</a></li>
        <li><a href="#response" data-toggle="tab">返回体</a></li>
    </ul>
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade in active" id="none" style="text-align: center;color: gray">
            <h3>这个请求不会携带任何请求体</h3>
        </div>
        <div class="tab-pane fade" id="form-data">
            {#            响应式表格布局#}
            <div class="table-responsive" style="width: 98%;color: black">

                <table class="table table-bordered table-striped" id="mytable" style="background-color:white">
                    <thead style="color: #337ab7;font-size: x-small">
                    <tr>
                        <th style="width: 30%">Key</th>
                        <th style="width: 50%">Value</th>
                    </tr>
                    </thead>
                    <tbody id="mytbody">
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>

                    </tbody>
                </table>
            </div>
            <button class="btn btn-default" id="add"><i class="fa fa-plus"></i> 添加新参数</button>
            {#  一般在这里个文件上边的<script>应该是有一个通过cdn加载文件jquery-1.11.0.min.js的路径，这里就是上边的路径不能加载文件的时候，使用下边的本地文件，一种优化响应的策略。#}
            <script>window.jQuery || document.write('<script src="/static/201801271505/js/jquery-1.11.0.min.js"><\/script>')</script>

            <script type="text/javascript" src="/static/201801271505/js/bootstable.js"></script>
            {#                        <script type="text/javascript">#}
            {#                            $('#mytable').SetEditable({#}
            {#                                $addButton: $('#add'),#}
            {#                            });#}
            {#                        </script>#}

        </div>
        <div class="tab-pane fade" id="x-www-form-urlencoded">
            <div class="table-responsive" style="width: 98%;color: black">

                <table class="table table-bordered table-striped" id="mytable2" style="background-color:white">
                    <thead style="color: #337ab7;font-size: x-small">
                    <tr>
                        <th style="width: 30%">Key</th>
                        <th style="width: 50%">Value</th>
                    </tr>
                    </thead>
                    <tbody id="mytbody2">
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>

                    </tbody>
                </table>
            </div>
            <button class="btn btn-default" id="add2"><i class="fa fa-plus"></i> 添加新参数</button>
            {#  一般在这里个文件上边的<script>应该是有一个通过cdn加载文件jquery-1.11.0.min.js的路径，这里就是上边的路径不能加载文件的时候，使用下边的本地文件，一种优化响应的策略。#}
            <script>window.jQuery || document.write('<script src="/static/201801271505/js/jquery-1.11.0.min.js"><\/script>')</script>

            <script type="text/javascript" src="/static/201801271505/js/bootstable.js"></script>
            {#            <script type="text/javascript">#}
            {#                $('#mytable2').SetEditable({#}
            {#                    $addButton: $('#add2'),#}
            {#                });#}
            {#            </script>#}

        </div>
        <div class="tab-pane fade" id="Text">
            <textarea name="" id="raw_Text" style="width: 98%;height: 300px;color: black"></textarea>
        </div>
        <div class="tab-pane fade" id="JavaScript">
            <textarea name="" id="raw_JavaScript" style="width: 98%;height: 300px;color: black"></textarea>
        </div>
        <div class="tab-pane fade" id="Json">
            <textarea name="" id="raw_Json" style="width: 98%;height: 300px;color: black"></textarea>
        </div>
        <div class="tab-pane fade" id="Html">
            <textarea name="" id="raw_Html" style="width: 98%;height: 300px;color: black"></textarea>
        </div>
        <div class="tab-pane fade" id="Xml">
            <textarea name="" id="raw_Xml" style="width: 98%;height: 300px;color: black"></textarea>
        </div>
        <div class="tab-pane fade" id="GraphQL">
            <table style="width: 98%">
                <thread>
                    <tr>
                        <td style="width: 55%"><span>QUERY</span></td>
                        <td style="width: 40%"><span>GRAPHQL VARIABLES</span></td>
                    </tr>
                </thread>
                <tbody style="color: black">
                <td><textarea id="body_plan_G_Q" rows="14"
                              style="padding-left: 3px;border-radius: 5px;width: 99%"></textarea></td>
                <td><textarea id="body_plan_G_G" rows="14"
                              style="padding-left: 3px;border-radius: 5px;width: 100%"></textarea></td>
                </tbody>
            </table>
        </div>
        <div class="tab-pane fade" id="response">
            <textarea name="" id="ts_response_body" disabled='disabled'
                      style="width: 98%;height: 300px;color: black"></textarea>
        </div>
    </div>
    <br>
</div>

{#弹窗功能#}
<script>
    //清理弹窗缓存
    function clear_ts_api() {
        $("#ts_api_id").text("");
        $("#ts_api_name").val("");
        $("#ts_url").val("");
        $("#ts_host").val("");
        $("#ts_header").val("{}");
        $("#ts_method").val('none');
        $("#click_none").click();
        $("#mytbody")[0].innerHTML = "<tr><td></td><td></td></tr>";
        $("#mytbody2")[0].innerHTML = "<tr><td></td><td></td></tr>";
        $("#raw_Text").val("");
        $("#raw_Html").val("");
        $("#raw_Xml").val("");
        $("#raw_Json").val("");
        $("#raw_JavaScript").val("");
        $("#ts_response_body").val("")

        // 运行第三方表格插件的函数：
        $('#mytable').SetEditable({
            $addButton: $('#add'),
        });
        $('#mytable2').SetEditable({
            $addButton: $('#add2'),
        });
    }

    function ts_close() {
        $("#ts").hide();
        $("#mengceng").hide();

    };

    function ts_save() {
        var api_name = $("#ts_api_name").val();
        var ts_method = document.getElementById('ts_method').value;
        var ts_url = document.getElementById('ts_url').value;
        var ts_host = document.getElementById('ts_host').value;

        var ts_header = $("#ts_header").val();
        var ts_body_method = $('ul#myTab li[class="active"]')[0].innerText;

        var project_headers = document.getElementById("ts_project_header_li").children;
        var ts_project_headers = [];
        for (var i = 0; i < project_headers.length; i++) {
            //首先用project_headers获取这li标签下所有 label标签，成为一个列表。然后for循环遍历，此时的project_headers[i]就是某个label，但是这个label内仍然有子元素，也就是我们要定位的input，所以还要再加.children方法来获取它下面的所有子标签，当然input是第一个，所以下标为[0]。
            if (project_headers[i].children[0].checked == true) {
                ts_project_headers.push(project_headers[i].children[0].value)
            }
        }
        // 判断参数是否填充完
        if (api_name == '') {
            alert("请输入接口名称");
            return
        }
        if (ts_method == '') {
            alert("请输入请求方法");
            return
        }
        if (ts_url == '') {
            alert("请输入请求地址");
            return
        }
        if (ts_host == '') {
            alert("请输入请求域名");
            return;
        }
        {#if(ts_header == ''){alert("请输入请求头信息")}#}

        // 判断输入格式   后面必须加return，这样js函数就会终止，不会再运行下去了，不然它虽然提示了错误，但是仍然会继续走代码而保存成功。
        if (ts_host.slice(0, 7) != 'http://' && ts_host.slice(0, 8) != 'https://' && ts_host.slice(0, 4) != "全局域名") {
            alert("host必须以http:// 或者 https:// 开头");
            return;
        }
        if (ts_header != '') {
            try {
                JSON.parse(ts_header);
            } catch (e) {
                alert("header 请求头不符合 json 规范!!");
                return;
            }
        }

        {#var ts_body_method = $("#myTab li[class='active']").text();#}
        if (ts_body_method == 'none') {
            var ts_api_body = "";
        }
        if (ts_body_method == 'form-data') {
            var ts_api_body = []; //新建这个空列表用来存放后续的数据
            var tbody_ = $("#mytable tbody")[0]; //获取该表格的内容部分
            var trlist = tbody_.children; //获取下面所有tr，每个tr就是一个键值对实际上
            for (var i = 0; i < trlist.length; i++) {
                var tdarr = trlist[i].children; // 获取tr下的俩个td
                var key = tdarr[0].innerText; // 获取key
                var value = tdarr[1].innerText; // 获取value
                ts_api_body.push([key, value]);// 作为一个数组，存放到这个大数组里。
            }
            ts_api_body = JSON.stringify(ts_api_body);
        }
        if (ts_body_method == 'x-www-form-urlencoded') {
            var ts_api_body = []; //新建这个空列表用来存放后续的数据
            var tbody_ = $("#mytable2 tbody")[0]; //获取该表格的内容部分
            var trlist = tbody_.children; //获取下面所有tr，每个tr就是一个键值对实际上
            for (var i = 0; i < trlist.length; i++) {
                var tdarr = trlist[i].children; // 获取tr下的俩个td
                var key = tdarr[0].innerText; // 获取key
                var value = tdarr[1].innerText; // 获取value
                ts_api_body.push([key, value]);// 作为一个数组，存放到这个大数组里。
            }
            console.log(ts_api_body);
            ts_api_body = JSON.stringify(ts_api_body);
        }
        if (ts_body_method == 'Text') {
            var ts_api_body = $("#raw_Text").val();
        }
        if (ts_body_method == 'JavaScript') {
            var ts_api_body = $("#raw_JavaScript").val();
        }
        if (ts_body_method == 'Json') {
            var ts_api_body = $("#raw_Json").val();
        }
        if (ts_body_method == 'Xml') {
            var ts_api_body = $("#raw_Xml").val();
        }
        if (ts_body_method == 'Html') {
            var ts_api_body = $("#raw_Html").val();
        }
        if (ts_body_method == 'GraphQL') {
            body_plan_G_Q = $("#body_plan_G_Q").val();
            body_play_G_G = $("#body_plan_G_G").val();
            var ts_api_body = body_plan_G_Q + "*WQRF*" + body_play_G_G
        }

        var api_id = $("#ts_api_id").text();

        $.get("/Api_save/", {
            "api_name": api_name,
            "api_id": api_id,
            "ts_method": ts_method,
            "ts_url": ts_url,
            "ts_host": ts_host,
            "ts_header": ts_header,
            "ts_body_method": ts_body_method,
            "ts_api_body": ts_api_body,
            "ts_project_headers": ts_project_headers.toString(),
        }, function (res) {
            {#$("#ts").hide();#}
            document.location.reload();
        })
    }

    function ts_show(id, name) {
        clear_ts_api();
        $("#mengceng").show();
        $("#mengceng")[0].style.zIndex = '998';
        $("#ts")[0].style.zIndex = '999';

        $("#ts")[0].style.display = 'block';
        $("#ts_api_id").text(id);
        {#$("#ts_api_name").val(name);#}

        $.get("/get_api_data/", {
            "api_id": id,
        }, function (res) {
            {#console.log(res);#}
            $("#ts_api_name").val(res["name"]);
            $("#ts_method").val(res.api_method);
            $("#ts_url").val(res.api_url);
            $("#ts_host").val(res.api_host);
            $("#ts_header").val(res.api_header);
            // 公共请求头
            var project_headers = res.public_header.split(',');
            for (var i = 0; i < project_headers.length; i++) {
                try {
                    document.getElementById('checkbox_' + project_headers[i]).checked = 'checked';
                } catch (e) {

                }
            }

            //请求体编码
            var body_method = "#" + res.body_method;
            console.log("li a[href=" + body_method + "]")
            $("li a[href=" + body_method + "]").click();
            //请求提显示
            if (res.body_method == "Text") {
                $("#Text").val(res.api_body);
            }
            if (res.body_method == "JavaScript") {
                $("#JavaScript").val(res.api_body);
            }
            if (res.body_method == "Json") {
                $("#Json").val(res.api_body);
            }
            if (res.body_method == "Html") {
                $("#Html").val(res.api_body);
            }
            if (res.body_method == "Xml") {
                $("#Xml").val(res.api_body);
            }
            if (res.body_method == 'form-data') {
                var tbody = document.getElementById('mytbody'); // 定位表格中的tbody部分
                body = eval(res.api_body); //把这个像列表的字符串请求体变成真正的列表
                for (var i = 0; i < body.length; i++) { // 遍历这个请求体列表
                    key = body[i][0]; //拿出每一个键值对的key
                    value = body[i][1];//拿出每一个键值对的value
                    var childs_tr = tbody.children;//获取到这个表格下面所有的tr组成的大列表
                    // 每个tr下的children得到的是 td列表，只有俩个。
                    childs_tr[i].children[0].innerText = key; //第一个td放key
                    childs_tr[i].children[1].innerText = value;//第二个td放value
                    //判断是否是最后一次遍历，来决定是否点击新增参数按钮
                    if (i < body.length - 1) {
                        document.getElementById('add').click();
                    }
                }
            }
            if (res.body_method == 'x-www-form-urlencoded') {
                var tbody = document.getElementById('mytbody2'); // 定位表格中的tbody部分
                body = eval(res.api_body); //把这个像列表的字符串请求体变成真正的列表
                for (var i = 0; i < body.length; i++) { // 遍历这个请求体列表
                    key = body[i][0]; //拿出每一个键值对的key
                    value = body[i][1];//拿出每一个键值对的value
                    var childs_tr = tbody.children;//获取到这个表格下面所有的tr组成的大列表
                    // 每个tr下的children得到的是 td列表，只有俩个。
                    childs_tr[i].children[0].innerText = key; //第一个td放key
                    childs_tr[i].children[1].innerText = value;//第二个td放value
                    //判断是否是最后一次遍历，来决定是否点击新增参数按钮
                    if (i < body.length - 1) {
                        document.getElementById('add2').click();
                    }
                }
            }
            if (res.body_method == 'GraphQL') {
                body_plan_G_Q = res.api_body.split("*WQRF*")[0];
                body_play_G_G = res.api_body.split("*WQRF*")[1];
                document.getElementById("body_plan_G_Q").value = body_plan_G_Q;
                document.getElementById('body_plan_G_G').value = body_play_G_G;
            }
        })

    }

    function ts_send() {
        var api_name = $("#ts_api_name").val();
        var ts_method = $("#ts_method option:selected").val();
        var ts_url = $("#ts_url").val();
        var ts_host = $("#ts_host").val();
        var ts_header = $("#ts_header").val();
        {#alert(ts_header+ts_host+ts_method+ts_url);#}
        var ts_body_method = $("#myTab li[class='active']").text();
        var project_headers = document.getElementById("ts_project_header_li").children;
        var ts_project_headers = [];
        for (var i = 0; i < project_headers.length; i++) {
            if (project_headers[i].children[0].checked == true) {
                ts_project_headers.push(project_headers[i].children[0].value)
            }
        }

        // 判断参数是否填充完
        {#if(api_name == ''){alert("请输入接口名称");return}#}
        if (ts_method == '') {
            alert("请输入请求方法");
            return
        }
        if (ts_url == '') {
            alert("请输入请求地址");
            return
        }
        if (ts_host == '') {
            alert("请输入请求域名");
            return;
        }

        // 判断输入格式   后面必须加return，这样js函数就会终止，不会再运行下去了，不然它虽然提示了错误，但是仍然会继续走代码而保存成功。
        if (ts_host.slice(0, 7) != 'http://' && ts_host.slice(0, 8) != 'https://' && ts_host.slice(0, 4) != "全局域名") {
            alert("host必须以http:// 或者 https:// 开头");
            return;
        }

        if (ts_header != '') {
            try {
                JSON.parse(ts_header);
            } catch (e) {
                alert("header 请求头不符合 json 规范!!");
                return;
            }
        }


        if (ts_body_method == 'none') {
            var ts_api_body = "";
        }
        if (ts_body_method == 'form-data') {
            var ts_api_body = []; //新建这个空列表用来存放后续的数据
            var tbody_ = $("#mytable tbody")[0]; //获取该表格的内容部分
            var trlist = tbody_.children; //获取下面所有tr，每个tr就是一个键值对实际上
            for (var i = 0; i < trlist.length; i++) {
                var tdarr = trlist[i].children; // 获取tr下的俩个td
                var key = tdarr[0].innerText; // 获取key
                var value = tdarr[1].innerText; // 获取value
                ts_api_body.push([key, value]);// 作为一个数组，存放到这个大数组里。
            }
            ts_api_body = JSON.stringify(ts_api_body);
        }
        if (ts_body_method == 'x-www-form-urlencoded') {
            var ts_api_body = []; //新建这个空列表用来存放后续的数据
            var tbody_ = $("#mytable2 tbody")[0]; //获取该表格的内容部分
            var trlist = tbody_.children; //获取下面所有tr，每个tr就是一个键值对实际上
            for (var i = 0; i < trlist.length; i++) {
                var tdarr = trlist[i].children; // 获取tr下的俩个td
                var key = tdarr[0].innerText; // 获取key
                var value = tdarr[1].innerText; // 获取value
                ts_api_body.push([key, value]);// 作为一个数组，存放到这个大数组里。
            }
            console.log(ts_api_body);
            ts_api_body = JSON.stringify(ts_api_body);
        }
        if (ts_body_method == 'Text') {
            var ts_api_body = $("#raw_Text").val();
        }
        if (ts_body_method == 'JavaScript') {
            var ts_api_body = $("#raw_JavaScript").val();
        }
        if (ts_body_method == 'Json') {
            var ts_api_body = $("#raw_Json").val();
        }
        if (ts_body_method == 'Xml') {
            var ts_api_body = $("#raw_Xml").val();
        }
        if (ts_body_method == 'Html') {
            var ts_api_body = $("#raw_Html").val();
        }
        if (ts_body_method == 'GraphQL') {
            body_plan_G_Q = $("#body_plan_G_Q").val();
            body_play_G_G = $("#body_plan_G_G").val();
            var ts_api_body = body_plan_G_Q + "*WQRF*" + body_play_G_G;
        }

        var api_id = $("#ts_api_id").text();

        $.get("/Api_send/", {
            "api_name": api_name,
            "api_id": api_id,
            "ts_method": ts_method,
            "ts_url": ts_url,
            "ts_host": ts_host,
            "ts_header": ts_header,
            "ts_body_method": ts_body_method,
            "ts_api_body": ts_api_body,
            "ts_project_headers": ts_project_headers.toString(),
        }, function (res) {
            $("li a[href=#response]").click();
            $("#ts_response_body").val(res);
        })
    }

    function ts_clear_host() {
        {#document.getElementById("ts_host").value = "";#}
        $("#ts_host").val("");
    }

    function ts_clear_header() {
        {#document.getElementById("ts_header").value = "";#}
        $("#ts_header").val("");
    }

    function ts_show_project_header() {
        $("#ts_project_header_li").show();
    }

</script>

{#异常值测试框#}
<div id="error_div" style="display: none;border-radius: 5px;
color: #fff;width: 80%;position: absolute;
left: 10%;top: 10%;background: #3c4043;
box-shadow: 4px 4px 4px gray;padding-left: 10px;">
    <div class="btn-group" style="float: right">
        <button onclick="error_play()" class="btn btn-success">开始测试</button>
        <button onclick="error_close()" class="btn btn-default">关闭</button>
    </div>
    <h4>接口：
        <large style="color: #0fd1ab" id="error_api_name"></large>
        的异常值测试结果如下：
    </h4>
    <strong> 替换的异常值参数为：</strong><br>
    <input id="ready_error_data" type="text" style="color: #000;width: 99%;border-radius: 5px"
           value="'a',123,'',' ','./?*&^','中文'">
    <br><br>
    {#    <span>替换： username -> 123</span>#}
    {#    <textarea name="" id="" style="border-radius: 5px;width: 99%;color: #000"></textarea>#}
    {#    <span>替换： username -> ' '</span>#}
    {#    <textarea name="" id="" style="border-radius: 5px;width: 99%;color: #000"></textarea>#}
    {#    <span>替换： username -> "abc"</span>#}
    {#    <textarea name="" id="" style="border-radius: 5px;width: 99%;color: #000"></textarea>#}

</div>
{#建立一个隐藏的input，然后在error_test运行时，把请求体写进去。在error_play运行时再提取出来即可。#}
<input type="text" style="display:none" id="error_api_body">
{#异常值测试script#}
<script>

    function error_test(api_id) {
        {# 新增了一个隐藏的input 用于存放动态id 和value#}
        var api_body = document.getElementById('api_error_' + api_id).value;
        {#显示蒙层 设置好蒙层层级关系#}
        $("#mengceng").show();
        $("#mengceng")[0].style.zIndex = '998';
        $("#error_div")[0].style.zIndex = '999';
        error_clean();
        $("#error_div").css("display", "block");
        $("#error_api_name").text(api_id);
        document.getElementById('error_api_body').value = api_body;

    }


    function error_play() {

        console.log("assdas");
        api_body = $("#error_api_body").val();
        ready_error_data = $("#ready_error_data").val();
        // 获取接口id
        var api_id = document.getElementById('error_api_name').innerText;
        console.log(api_id)
        //把预替换数据从一个大字符串，按逗号解析成数组。
        var r = ready_error_data.split(",");
        console.log(api_body);
        console.log(ready_error_data);
        //判断是不是fourm-data 或者x-www..的二维数组格式
        try {
            var s = eval(api_body);
            if (s instanceof Array) {
                console.log("这是数组");
                for (var i = 0; i < s.length; i++) {
                    for (var j = 0; j < r.length; j++) {
                        var new_body = [];
                        $.extend(true, new_body, s);
                        new_body[i][1] = eval(r[j]);
                        console.log(new_body);
                        //参数替换规则
                        var span_text = '替换' + new_body[i][0] + '---->' + r[j];
                        $.get("/error_request/", {
                            "api_id": api_id,
                            "new_body": JSON.stringify(new_body),
                            "span_text": span_text
                        }, function (res) {
                            res = eval(res);
                            error_show_respnse(res.span_text, res.response);
                        })

                    }
                }

            } else {
                console.log("这是none");
                alert("当前请求体不含任何内容！");
            }
            console.log(s);
            // 如果不是就继续判断是不是raw-json格式
        } catch (e) {
            try {
                var s = JSON.parse(api_body);
                console.log(s);
                console.log("这是字典json");
                for (var i in s) {
                    for (var j = 0; j < r.length; j++) {
                        {#这里的new_body是json格式，不是二维数组了！！！！！！！#}
                        var new_body = {};
                        $.extend(true, new_body, s);
                        new_body[i] = eval(r[j]);
                        console.log(new_body);
                        var span_text = '替换' + i + '---->' + r[j];
                        $.get("/error_request/", {
                            "api_id": api_id,
                            "new_body": JSON.stringify(new_body),
                            "span_text": span_text
                        }, function (res) {
                            res = eval(res);
                            error_show_respnse(res.span_text, res.response);
                        })
                    }
                }

            } catch (e) {
                //若也不是，那就不需要做异常测试了
                alert("当前接口的请求体类型不支持异常值测试");
            }

        }
    }

    {#结果展示#}

    function error_show_respnse(span_text, res) {
        var error_div = document.getElementById('error_div'); // 声明这个请求体展示窗口
        var s = document.createElement('span'); //创造替换标题
        s.innerText = span_text;

        var t = document.createElement('textarea'); //传教替换内容多行文本
        t.style = 'width: 99%;height: 50px;border-radius: 5px;color: black;margin-bottom: 10px';
        t.value = res;

        error_div.appendChild(s);
        error_div.appendChild(t);
    }

    function error_close() {
        {#$("#error_div").css("display","none");#}
        document.location.reload();
    }

    function error_clean() {
        $("#error_div").html(' <div class="btn-group" style="float: right">' +
            '<button onclick="error_play()" class="btn btn-success">开始测试</button>' +
            '<button onclick="error_close()" class="btn btn-default">关闭</button>' +
            '</div>' +
            '<h4 >接口：<large style="color: #0fd1ab" id="error_api_name"></large>  的异常值测试结果如下：</h4>' +
            '<strong> 替换的异常值参数为：</strong><br>' +
            '<input type="text" style="color: #000;width: 99%;border-radius: 5px" id="ready_error_data" value="\'a\',123,\'\',\' \',\'./?*&^\',\'中文\'">' +
            '<br><br>')
    }


</script>

{#全局请求头#}
<div id="project_header_div" style="display: none;border-radius:5px;width: 70%;height: 70%;
position: absolute;left: 15%;top: 15%;box-shadow: 4px 4px 8px grey;z-index: 3;
padding-left: 10px;background-color: white">
    <div class="btn-group" style="float: right;margin-top: 5px">
        <button onclick="project_header_save()" type="button" class="btn btn-success">保存</button>
        <button onclick="project_header_close()" type="button" class="btn btn-danger">取消</button>
    </div>
    <h3>请设置本项目的全局公共请求头：</h3>
    <br>
    <div id="header_plan">
        {% for i in project_header %}
            <input type="text" name="header_id" value="{{ i.id }}" style="display: none">
            <input type="text" name="header_name" value="{{ i.name }}" style="width: 20%;margin-top: 3px"
                   placeholder="请求头name"> = {"
            <input type="text" name="header_key" value="{{ i.key }}" style="width: 15%;margin-top: 3px"
                   placeholder="请求头key"> " : "
            <input type="text" name="header_value" value="{{ i.value }}" style="width: 50%;margin-top: 3px"
                   placeholder="请求头value"> "}
            <br>
        {% endfor %}
    </div>
    <br>
    <button onclick="add_project_header()" class="btn btn-primary">新增</button>

</div>
<script>
    function project_header_div_show() {
        $("#project_header_div").show();
    }

    function project_header_close() {
        document.location.reload();
    }

    function project_header_save() {
        var names = document.getElementsByName('header_name');
        var keys = document.getElementsByName("header_key");
        var values = document.getElementsByName("header_value");
        var ids = document.getElementsByName("header_id");
        var req_ids = [];
        var req_names = [];
        var req_keys = [];
        var req_values = [];
        for (var i = 0; i < names.length; i++) {
            //if (names[i].value != "") {
            req_names.push(names[i].value);
            req_keys.push(keys[i].value);
            req_values.push(values[i].value);
            req_ids.push(ids[i].value)
            // }
        }
        console.log(req_names);
        console.log(req_keys);
        console.log(req_values);
        $.get("/save_project_header/", {
            "project_id": "{{ project.id }}",
            "req_names": req_names.toString(),
            "req_keys": req_keys.toString(),
            "req_values": req_values.toString(),
            "req_ids": req_ids.toString()
        }, function (ret) {
            document.location.reload();
        })
    }

    function add_project_header() {
        var header_plan = document.getElementById('header_plan');
        var i0 = document.createElement('input');
        i0.style.display = 'none';
        i0.value = 'new';
        i0.name = "header_id";
        var i1 = document.createElement('input');
        i1.style = "width: 20%;margin-top: 3px";
        i1.placeholder = "请求头name";
        i1.name = "header_name";
        var i2 = document.createElement('input');
        i2.style = "width: 15%;margin-top: 3px";
        i2.placeholder = "请求头key";
        i2.name = "header_key";
        var i3 = document.createElement('input');
        i3.style = "width: 50%;margin-top: 3px";
        i3.placeholder = "请求头value";
        i3.name = "header_value";
        header_plan.appendChild(i0);
        header_plan.appendChild(i1);
        header_plan.appendChild(document.createTextNode(' = {" '));
        header_plan.appendChild(i2);
        header_plan.appendChild(document.createTextNode(' " : " '));
        header_plan.appendChild(i3);
        header_plan.appendChild(document.createTextNode(' "} '));
        header_plan.appendChild(document.createElement("br"))
    }
</script>

{#全局域名#}
<div id="project_host_div" style="display: none;border-radius:5px;width: 70%;height: 70%;
position: absolute;left: 15%;top: 15%;box-shadow: 4px 4px 8px grey;z-index: 3;
padding-left: 10px;background-color: white">
    <div class="btn-group" style="float: right;margin-top: 5px">
        <button onclick="project_host_save()" type="button" class="btn btn-success">保存</button>
        <button onclick="project_host_close()" type="button" class="btn btn-danger">取消</button>
    </div>
    <h3>请设置本项目的全局公共请求头：</h3>
    <br>
    <div id="host_plan">
        {% for i in project_host %}
            <input type="text" name="host_id" value="{{ i.id }}" style="display: none;">
            <input type="text" name="host_name" value="{{ i.name }}" style="width: 20%;margin-top: 3px"
                   placeholder="域名name"> = "
            <input type="text" name="host_host" value="{{ i.host }}" style="width: 70%" placeholder="全局host地址"> "
            <br>
        {% endfor %}
    </div>
    <br>
    <button onclick="add_project_host()">新增</button>
</div>
{# 全局域名js#}
<script>
    function project_host_div_show() {
        $("#project_host_div").show();
    }

    function project_host_close() {
        document.location.reload();
    }

    function project_host_save() {
        var names = document.getElementsByName('host_name');
        var hosts = document.getElementsByName("host_host");
        var ids = document.getElementsByName("host_id");
        var req_ids = [];
        var req_names = [];
        var req_hosts = [];
        for (var i = 0; i < names.length; i++) {
            //if (names[i].value != "") {
            req_names.push(names[i].value);
            req_hosts.push(hosts[i].value);
            req_ids.push(ids[i].value)
            // }
        }


        $.get("/save_project_host/", {
            "project_id": "{{ project.id }}",
            "req_names": req_names.toString(),
            "req_hosts": req_hosts.toString(),
            "req_ids": req_ids.toString()
        }, function (ret) {
            document.location.reload();
        })
    }

    function add_project_host() {
        var host_plan = document.getElementById('host_plan');
        var i0 = document.createElement('input');
        i0.name = 'host_id';
        i0.value = 'new';
        i0.style.display = 'none';
        var i1 = document.createElement('input');
        i1.style = 'width: 20%;margin-top: 3px';
        i1.placeholder = '请输入域名name';
        i1.name = 'host_name';
        var i2 = document.createElement('input');
        i2.style = 'width: 70%';
        i2.placeholder = '请输入全局host地址';
        i2.name = 'host_host';
        host_plan.appendChild(i0);
        host_plan.appendChild(i1);
        host_plan.appendChild(document.createTextNode(' = " '));
        host_plan.appendChild(i2);
        host_plan.appendChild(document.createTextNode(' "'));
        host_plan.appendChild(document.createElement("br"));
    }
</script>

{# 登录态接口#}
<div id="login_set_div" style="display:none;border-radius:5px;width: 50%;position: absolute;left: 20%;
top: 20%;background: white;color: black;padding-left: 10px">
    <div class="btn btn-group" style="float: right;padding: 0px">
        <button onclick="login_save()" class="btn btn-success">保存</button>
        <button onclick="login_close()" class="btn btn-default">取消</button>
    </div>
    <h3>请设置该项目的登录态接口</h3>
    <br>
    {#    请求方式和url#}
    <ul class="nav navbar-nav" style="width: 98%">
        <li>
            <select id="login_method" style="height: 40px;" class="form-control">
                <option value="none">请求方式</option>
                <option value="post">POST</option>
                <option value="get">GET</option>
                <option value="put">PUT</option>
                <option value="delete">DELETE</option>
            </select>
        </li>
        <li style="width: -webkit-calc(100% - 225px)">
            <input id="login_url" style="color: black;padding-left: 10px;width: 100%;
           height: 40px;" placeholder="url: 如 /abcd/efgh/" type="text">
        </li>
        <li>
            <button onclick="" type="button"
                    style="height: 40px;width: 120px;"
                    class="btn btn-default"><span style="font-size: large">Send</span></button>
        </li>
    </ul>
    <br><br><br>
    {#    请求host#}
    <ul class="nav navbar-nav" style="width:98%">
        <li style="width: 100%">
            <input list="datalist_1" id="login_host" type="text" autocomplete="off"
                   style="color: #000000;padding-left: 10px;width: 100%;height: 40px"
                   placeholder="host:如http(s)://xxxx.com" value="">
        </li>

    </ul>
    <br><br><br>
    {#    请求头#}
    <ul class="nav navbar-nav" style="width: 98%">
        <li style="width: 100%">
            <input id="login_header" style="color: black;padding-left: 10px;width: 100%;height: 40px;" type="text"
                   placeholder='header请求头：如{"Content":"application/json"}' value="">
        </li>
    </ul>
    <br><br><br>

    <ul id="login_myTab" class="nav nav-tabs">
        <li class="active"><a id="login_click_none" href="#login_none" data-toggle="tab">none</a></li>
        <li><a href="#login_form-data" data-toggle="tab">form-data</a></li>
        <li><a href="#login_x-www-form-urlencoded" data-toggle="tab">x-www-form-urlencoded</a></li>
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">raw <b class="caret"></b></a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="login_myTabDrop1">
                <li><a href="#login_Text" tabindex="-1" data-toggle="tab">Text</a></li>
                <li><a href="#login_JavaScript" tabindex="-1" data-toggle="tab">JavaScript</a></li>
                <li><a href="#login_Json" tabindex="-1" data-toggle="tab">Json</a></li>
                <li><a href="#login_Html" tabindex="-1" data-toggle="tab">Html</a></li>
                <li><a href="login_#Xml" tabindex="-1" data-toggle="tab">Xml</a></li>
            </ul>
        </li>
        <li><a href="#login_GraphQL" data-toggle="tab">GraphQL</a></li>
        <li><a href="#login_response" data-toggle="tab">返回体</a></li>
    </ul>
    <div id="login_myTabContent" class="tab-content">
        <div class="tab-pane fade in active" id="login_none" style="text-align: center;color: grey">
            <h3>这个请求将不会携带任何请求体</h3>
            <h5>This request will not carry any request-body</h5>
        </div>
        <div class="tab-pane fade" id="login_form-data">
            <div class="table-responsive" style="width: 98%;color: black">
                <table class="table table-bordered table-striped" id="login_mytable" style="background-color:white">
                    <thead style="color: #337ab7;font-size: x-small">
                    <tr>
                        <td style="width: 30%">Key</td>
                        <td style="width: 50%">Value</td>
                    </tr>
                    </thead>
                    <tbody id="login_mytbody">
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <button class="btn btn-default" id="login_add"><i class="fa fa-plus"></i> 添加新参数</button>
            <script>window.jQuery || document.write('<script src="/static/201801271505/js/jquery-1.11.0.min.js"><\/script>')</script>
            <script type="text/javascript" src="/static/201801271505/js/bootstable.js"></script>
        </div>
        <div class="tab-pane fade" id="login_x-www-form-urlencoded">
            <div class="table-responsive" style="width: 98%;color: black">
                <table class="table table-bordered table-striped" id="login_mytable2" style="background-color:white">
                    <thead style="color: #337ab7;font-size: x-small">
                    <tr>
                        <td style="width: 30%">Key</td>
                        <td style="width: 50%">Value</td>
                    </tr>
                    </thead>
                    <tbody id="login_mytbody2">
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <button class="btn btn-default" id="login_add2"><i class="fa fa-plus"></i> 添加新参数</button>
            <script>window.jQuery || document.write('<script src="/static/201801271505/js/jquery-1.11.0.min.js"><\/script>')</script>
            <script type="text/javascript" src="/static/201801271505/js/bootstable.js"></script>
        </div>
        <div class="tab-pane fade" id="login_Text">
            <textarea name="" id="login_raw_Text" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
        <div class="tab-pane fade" id="login_JavaScript">
            <textarea name="" id="login_raw_JavaScript" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
        <div class="tab-pane fade" id="login_Json">
            <textarea name="" id="login_raw_Json" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
        <div class="tab-pane fade" id="login_Html">
            <textarea name="" id="login_raw_Html" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
        <div class="tab-pane fade" id="login_Xml">
            <textarea name="" id="login_raw_Xml" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
        <div class="tab-pane fade" id="login_GraphQL">
            <table style="width: 98%">
                <thead>
                <tr>
                    <td style="width: 55%"><span>QUERY</span></td>
                    <td style="width: 40%"><span>GRAPHQL VARIABLES</span></td>
                </tr>
                </thead>
                <tbody style="color: black">
                <tr>
                    <td><textarea id="login_body_plan_G_Q" rows="14"
                                  style="padding-left: 3px;border-radius: 5px;width: 99%"></textarea></td>
                    <td><textarea id="login_body_plan_G_G" rows="14"
                                  style="padding-left: 3px;border-radius: 5px;width: 100%"></textarea></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="tab-pane fade" id="login_response">
            <ul class="nav navbar-nav" style="width: 98%">
                <li style="width: 33%;">
            <textarea name="" id="login_response_body" disabled="disabled"
                      style="background-color: #e4f3f5;color: black;width: 100%;height: 300px"
                      placeholder="返回体"></textarea>
                </li>
                <li style="width: 33%;">
             <textarea name="" id="login_response_set"
                       style="color: black;width: 100%;height: 300px"
                       placeholder="请输入提取设置，=号左边写变量名，右边写绝对路径，多个用换行分开，格式例如：sessId=/content/sessIdtoken=/data/token"></textarea>
                </li>
                <li style="width: 33%;">
             <textarea name="" id="login_response_result" disabled="disabled"
                       style="background-color: #f5eeec;color: black;width: 100%;height: 300px"
                       placeholder="提取结果"></textarea>

                </li>
            </ul>
        </div>
    </div>

    <br>


</div>

<script>
   function login_show() {
    //显示蒙层，并设置好蒙层的层级关系，让其在调试层之下，其他元素之上
    document.getElementById('mengceng').style.display='block';
    document.getElementById('mengceng').style.zIndex='998';
    document.getElementById('login_set_div').style.zIndex='999';
    document.getElementById('login_set_div').style.display = 'block';
    $.get("/project_get_login/",{
        "project_id":"{{ project.id }}"
    },function (ret) {
        console.log(ret);
         // 运行第三方表格插件的函数：
        $('#login_mytable').SetEditable({
            $addButton: $('#login_add'),
        });
        $('#login_mytable2').SetEditable({
            $addButton: $('#login_add2'),
        });
        document.getElementById('login_method').value = ret.api_method;
        document.getElementById('login_url').value = ret.api_url;
        document.getElementById('login_host').value = ret.api_host;
        document.getElementById('login_header').value = ret.api_header;
        document.getElementById('login_response_set').value = ret.set;
        // 请求体编码格式
        var body_method = '#'+ret.body_method;

        $("li a[href="+body_method+"]").click();
        // 请求体显示
        if(ret.body_method == 'login_Text'){
            document.getElementById('login_raw_Text').value = ret.api_body;
        }
        if(ret.body_method == 'login_JavaScript'){
            document.getElementById('login_raw_JavaScript').value = ret.api_body;
        }
        if(ret.body_method == 'login_Json'){
            document.getElementById('login_raw_Json').value = ret.api_body;
        }
        if(ret.body_method == 'login_Html'){
            document.getElementById('login_raw_Html').value = ret.api_body;
        }
        if(ret.body_method == 'login_Xml'){
            document.getElementById('login_raw_Xml').value = ret.api_body;
        }
        if(ret.body_method == 'login_form-data'){
            var tbody = document.getElementById('login_mytbody'); // 定位表格中的tbody部分
            body = eval(ret.api_body); //把这个像列表的字符串请求体变成真正的列表
            for(var i=0;i<body.length;i++){ // 遍历这个请求体列表
                key = body[i][0]; //拿出每一个键值对的key
                value = body[i][1];//拿出每一个键值对的value
                var childs_tr = tbody.children ;//获取到这个表格下面所有的tr组成的大列表
                // 每个tr下的children得到的是 td列表，只有俩个。
                childs_tr[i].children[0].innerText = key; //第一个td放key
                childs_tr[i].children[1].innerText = value;//第二个td放value
                //判断是否是最后一次遍历，来决定是否点击新增参数按钮
                if(i<body.length-1){
                    document.getElementById('login_add').click()
                }
            }
        }
        if(ret.body_method == 'login_x-www-form-urlencoded'){
            var tbody = document.getElementById('login_mytbody2'); // 定位表格中的tbody部分
            body = eval(ret.api_body); //把这个像列表的字符串请求体变成真正的列表
            for(var i=0;i<body.length;i++){ // 遍历这个请求体列表
                key = body[i][0]; //拿出每一个键值对的key
                value = body[i][1];//拿出每一个键值对的value
                var childs_tr = tbody.children ;//获取到这个表格下面所有的tr组成的大列表
                // 每个tr下的children得到的是 td列表，只有俩个。
                childs_tr[i].children[0].innerText = key; //第一个td放key
                childs_tr[i].children[1].innerText = value;//第二个td放value
                //判断是否是最后一次遍历，来决定是否点击新增参数按钮
                if(i<body.length-1){
                    document.getElementById('login_add2').click()
                }
            }
        }

    })
}

    function login_close() {
        document.location.reload();
    }
</script>

</body>
</html>